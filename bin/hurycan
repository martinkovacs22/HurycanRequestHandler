#!/usr/bin/env php
<?php

echo "Hurycan CLI Tool üöÄ\n";

// Argumentumok ellen≈ërz√©se
if ($argc > 1) {
    $command = $argv[1];

    switch ($command) {
        case 'setdb':
            if (isset($argv[2]) && isset($argv[3]) && isset($argv[4]) && isset($argv[5]) && isset($argv[6])) {
                $host = $argv[2];
                $dbName = $argv[3];
                $user = $argv[4];
                $password = $argv[5];
                $port = $argv[6];
                
                // H√≠vjuk meg a f√ºggv√©nyt, hogy m√≥dos√≠tsuk a config.ini f√°jlt
                setDatabaseConfig($host, $dbName, $user, $password, $port);
            } else {
                echo "Hib√°s adatb√°zis kapcsolat param√©terek. A parancsnak √≠gy kell kin√©znie: php bin/hurycan setdb <host> <dbname> <user> <password> <port>\n";
            }
            break;
        default:
            echo "Ismeretlen parancs: $command\n";
            break;
    }
} else {
    echo "Haszn√°lat: hurycan [parancs]\n";
}

// Set Database Config Function
function setDatabaseConfig($host, $dbName, $user, $password, $port) {
    $configFile = 'src/config.ini';

    // Ellen≈ërizz√ºk, hogy a f√°jl l√©tezik-e
    if (!file_exists($configFile)) {
        echo "A config.ini f√°jl nem tal√°lhat√≥: $configFile\n";
        return;
    }

    // Beolvassuk a config.ini f√°jlt
    $configContent = file_get_contents($configFile);

    // [db] szekci√≥ keres√©se
    $dbSectionPattern = '/\[db\](.*?)\z/s'; // Az eg√©sz [db] szekci√≥t keresj√ºk, bele√©rtve a hozz√°tartoz√≥ kulcsokat

    if (preg_match($dbSectionPattern, $configContent, $matches)) {
        $dbSection = $matches[1];

        // A db_host, db_name, db_username, db_pass √©s db_port √©rt√©kek m√≥dos√≠t√°sa
        $updatedDbSection = preg_replace([
            '/db_host\s*=\s*"?.*"?/',   // db_host v√°ltoztat√°sa
            '/db_name\s*=\s*"?.*"?/',   // db_name v√°ltoztat√°sa
            '/db_username\s*=\s*"?.*"?/',  // db_username v√°ltoztat√°sa
            '/db_pass\s*=\s*"?.*"?/',    // db_pass v√°ltoztat√°sa
            '/db_port\s*=\s*"?.*"?/'     // db_port v√°ltoztat√°sa
        ], [
            "db_host = \"$host\"",
            "db_name = \"$dbName\"",
            "db_username = \"$user\"",
            "db_pass = \"$password\"",
            "db_port = \"$port\""
        ], $dbSection);

        // A teljes f√°jlban a db szekci√≥ friss√≠t√©se
        $updatedContent = preg_replace($dbSectionPattern, "[db]\n$updatedDbSection", $configContent);

        // F√°jlba √≠r√°s
        file_put_contents($configFile, $updatedContent);

        echo "Adatb√°zis be√°ll√≠t√°sok friss√≠tve: $host, $dbName, $user, $password, $port\n";
    } else {
        echo "A [db] szekci√≥ nem tal√°lhat√≥ a config.ini f√°jlban.\n";
    }
}
